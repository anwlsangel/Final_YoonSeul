<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="paymentMapper">

	<!-- BUYLIST 테이블의 조회 결과를 BuyList VO 객체로 옮겨주는 ResultMap -->
	<resultMap type="buylist" id="buylistResultSet">
		<result column="BUYLIST_ID" property="buyListId"/>
		<result column="RESERVE_CODE" property="reserveCode"/>
		<result column="RESERVE_CONCERT_ID" property="reserveConcertId"/>
		<result column="RESERVE_TICKET" property="reserveTicket"/>
		<result column="RESERVE_SUM" property="reserveSum"/>
		<result column="RESERVE_PAYMENT" property="reservePayment"/>
		<result column="RESERVE_REFUND" property="reserveRefund"/>
		<result column="USER_ID" property="userId"/>
		<result column="STATUS" property="status"/>
	</resultMap>
	<resultMap type="concert" id="concertResultSet">
		<result column="CONCERT_ID" property="concertId"/>
		<result column="CONCERT_NAME" property="concertName"/>
		<result column="AGE_LIMIT" property="ageLimit"/>
		<result column="PRICE" property="price"/>
		<result column="THUMBNAIL_ROOT" property="thumbnailRoot"/>
		<result column="DETAIL_ROOT" property="detailRoot"/>
		<result column="PLAYTIME" property="playTime"/>
		<result column="START_DATE" property="startDate"/>
		<result column="END_DATE" property="endDate"/>
		<result column="CATEGORY" property="category"/>
		<result column="HOLE_NAME" property="holeName"/>
	</resultMap>
	
	<!-- 결제정보 저장 -->
	<insert id="insertPaymentInfo" parameterType="buylist">
		INSERT INTO BUYLIST
		VALUES(#{buyListId}
		     , #{reserveCode}
		     , #{reserveConcertId}
		     , #{reserveTicket}
		     , #{reserveSum}
		     , SYSDATE
		     , NULL
		     , #{userId})
	</insert>
	
	<!-- 환불일 업데이트 -->
	<update id="updateReserveRefund" parameterType="string">
		UPDATE BUYLIST
		   SET RESERVE_REFUND = SYSDATE
		 WHERE BUYLIST_ID = #{merchant_uid}
	</update>
	
	<!-- 예매내역 상세조회 -->
	<select id="selectBuyList" parameterType="string" resultMap="buylistResultSet">
		SELECT *
		  FROM BUYLIST
		 WHERE BUYLIST_ID = #{tno}
	</select>
	<select id="selectConcert" parameterType="string" resultMap="concertResultSet">
		SELECT *
		  FROM CONCERT_INFO
		 WHERE CONCERT_ID = #{concertId}
	</select>
	
	<!-- 관리자-결제내역전체조회 -->
	<select id="selectPaymentList" resultMap="buylistResultSet">
		SELECT BUYLIST_ID
		     , CONCERT_NAME AS "RESERVE_CONCERT_ID"
		     , RESERVE_SUM
		     , RESERVE_PAYMENT
		     , RESERVE_REFUND
		     , USER_ID
		     , B.STATUS
		  FROM BUYLIST B
		  JOIN CONCERT_INFO ON (RESERVE_CONCERT_ID = CONCERT_ID)
	</select>
	<!-- 관리자-환불요청내역조회 -->
	<select id="selectRefundList" resultMap="buylistResultSet">
		SELECT BUYLIST_ID
		     , CONCERT_NAME AS "RESERVE_CONCERT_ID"
		     , RESERVE_SUM
		     , RESERVE_PAYMENT
		     , RESERVE_REFUND
		     , USER_ID
		     , B.STATUS
		  FROM BUYLIST B
		  JOIN CONCERT_INFO ON (RESERVE_CONCERT_ID = CONCERT_ID)
		 WHERE B.STATUS = 2
	</select>
	
</mapper>

	